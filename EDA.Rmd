---
title: "EDA"
author: "Larissa Bouwknegt"
date: "2023-09-13"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(reshape)
library(GGally)

```

## Introduction
"Crab age prediction" is a kaggle dataset (https://www.kaggle.com/datasets/sidhus/crab-age-prediction) with the physical properties and age of crabs farmed around Boston area. Crab is a food eaten and imported in many countries. Crab farming has low labor costs, production cost is comparatively lower and crabs grow fast. By knowing the right time to harvest crabs, when they mostly stop growing, profits can be maximized. This exploratory data analysis is to find connections between the different physical properties and the age of crabs. 

## First look and preperation
The data set contains the data of 3893 crabs, with data in 9 categories. The 9 categories data was collected in are, this will later be added to a codebook:
- Sex (gender of the crab)
- Length (length of the crab in feet)
- Diameter (diameter of the crab in feet)
- Height (height of the crab in feet)
- Weight (weight of the crab in ounces)
- Shucked weight (weight of the crab without the shell in ounces)
- Viscera weight (weight that wraps around your abdominal organs deep inside body in ounces)
- Shell weight (weight of the shell in ounces)
- Age (age of the crab in months)

When importing the data set we can check if everything is as expected with a quick summary.

```{r}
crab_data <- read.csv("CrabAgePrediction.csv")
summary(crab_data)

```

A quick summary shows that there are indeed 9 categories collected for 3893 entries. It also gives a first insight into the distribution of the data. The age of the crabs goes from 1 month to 29 months with a mean of 9.955 which suggest that most crabs are young compared to the oldest entry. A deeper exploration of the distribution will be done later. First there will be a check for missing data and a conversion to centimeters and grams.
 
```{r}
sum(is.na(crab_data))
```
A sum of the NA values shows that there are no missing value which means the data set is complete for all categories. 

The next step is conversion to centimeters and grams since that are the conventional metrics in the Netherlands where this EDA is conducted. 

1 foot equals 30.48 centimeters and 1 ounces equals 28.3495231 grams, this can then be applied to the correct categories with simple indexing and concatenation.

```{r}
crab_data[,c("Length", "Diameter", "Height" )] <- crab_data[,c("Length", "Diameter", "Height" )] * 30.48
crab_data[,c("Weight", "Shucked.Weight", "Viscera.Weight", "Shell.Weight")] <- crab_data[,c("Weight", "Shucked.Weight", "Viscera.Weight", "Shell.Weight")] * 28.3495231
```

To check if the conversion worked the head is looked at.

```{r}
head(crab_data)
```
The values in the desired columns have changed so the conversions seem to have worked.

The next step is to make a codebook for readability and easy labeling. The codebook is made by using the colnames of the crab_data dataframe as the attributes and manually adding the units and descriptions to it.  
```{r}
codebook <- list("Attribute" = c(colnames(crab_data)), "Units" = c("-", "cm", "cm", "cm", "gram", "gram", "gram", "gram", "months"), "Description" = c("Gender of the crab, female(F), male(M) or interderminate(I)", "Lenght of the crab in centimeters", "Diameter of the crab in centimeters", "Height of the crab in centimeters", "Weight of the crab in grams", "Weight without the shell in grams", "Weight that wraps around your abdominal organs deep inside body in grams", "Weight of the shell in grams", "Age of the crab in months"))

codebook_df <- as.data.frame(codebook)
codebook_df
``` 

## Data exploration

The first thing to do is to look at the distribution of the categories. The gender is the only nominal category. 

```{r}
gender_count <- ggplot(data = crab_data, aes(x=Sex, fill=Sex)) + geom_bar(fill = c('pink', 'green', 'blue'))
gender_count + ggtitle("Distribution of the sex in the crab dataset")
``` 

```{r}
summary(crab_data)
```

A boxplot with the categories in centimeters is made. First the data is reshaped to be able to plot them together.  

```{r}

cm_data <- melt(crab_data[2:4])
ggplot(cm_data, aes(x=variable, y=value)) + geom_boxplot()

```
 
 The boxplots show that the height catagorie has a huge outlier. The same steps are taken with the weight categories.
 
```{r}
gram_data <- melt(crab_data[5:8])
ggplot(gram_data, aes(x=variable, y=value)) + geom_boxplot()
```
The weight categories also have outliers. Next let's look at the distribution of the age through a histogram. 

```{r}
ggplot(crab_data, aes(Age)) + geom_histogram()
```
Most of the crabs appear to be younger then 10 years

```{r}
ggpairs(crab_data)
```

```{r}
cormat <- round(cor(crab_data[,2:9]),2)
melted_cormat <- melt(cormat)
head(melted_cormat)
ggplot(data = melted_cormat, aes(x=X1, y=X2, fill=value)) + 
  geom_tile()
```

```{r}
ggplot(crab_data, aes(x=Length, y=Age)) + 
  geom_point() +
  geom_abline(color='red')
```


